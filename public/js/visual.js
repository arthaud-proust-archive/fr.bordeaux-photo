(()=>{function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,a){if(!t)return;if("string"==typeof t)return e(t,a);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return e(t,a)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,r=new Array(e);a<e;a++)r[a]=t[a];return r}var a=document.querySelectorAll(".visual.laureat"),r=document.querySelectorAll(".visual.event"),i=4096,o=3276.8;function l(t,e){t.parentElement.classList.add("downloaded");var a="image/jpeg",r=t.toDataURL(a),i=document.createElement("a");i.download=e+".jpg",i.href=r,i.dataset.downloadurl=[a,i.download,i.href].join(":"),document.body.appendChild(i),i.click(),document.body.removeChild(i)}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},a.forEach((function(t){var e=t.querySelector("canvas");e.height=e.width=i;var a,r,n,s,d,c,f=e.getContext("2d");f.fillStyle="#0d0d0e",f.fillRect(0,0,i,i),function(t,e,a){var r,n,l,s,d,c=new Image;c.addEventListener("load",(function(){c.width==c.height?(r=1,s=d=o):c.width<c.height?(r=c.width/c.height,d=o,s=o*r):(r=c.height/c.width,d=o*r,s=o),n=(i-s)/2,l=(i-d)/2,e.drawImage(c,n,l,s,d),a()}),!1),c.src=t.dataset.image}(t,f,(function(){f.fillStyle="#ffffff",f.font="110px sans-serif";var e=f.measureText("@photo_a_bordeaux");f.fillRect(0,150,i-(400+e.width),10),f.fillText("@photo_a_bordeaux",i-(350+e.width),190),f.fillRect(3796,150,300,10),f.font="180px sans-serif",a="Par ".concat(t.dataset.author),r=f.measureText(a),n="Thème ".concat(t.dataset.event),d=JSON.parse(t.dataset.laureats).join(" - "),s=f.measureText(n),c=f.measureText(d),f.rotate(-Math.PI/2),f.fillRect(-4096,150,300,10),f.fillText(a,-3696,200),f.fillRect(-3596+r.width,150,i-(100+r.width),10),f.rotate(Math.PI),f.fillRect(0,-3946,300,10),f.fillText(n,400,-3876),f.fillRect(500+s.width,-3946,i-(100+s.width),10),f.rotate(-Math.PI/2),f.fillRect(0,3946,300,10),f.fillText(d,400,3996),f.fillRect(500+c.width,3946,i-(100+c.width),10)})),e.addEventListener("click",(function(){l(this,"".concat(t.dataset.event," - ").concat(d))})),e.addEventListener("contextmenu",(function(e){e.preventDefault(),l(this,"".concat(t.dataset.event," - ").concat(d))})),e.parentElement.addEventListener("mouseenter",(function(){this.classList.remove("downloaded")}))})),r.forEach((function(e){var a=e.querySelector("canvas");a.height=a.width=i;var r=a.getContext("2d");r.fillStyle="#ffffff",r.fillRect(0,0,i,i),r.fillStyle="#0d0d0e",r.font="110px sans-serif";var o=r.measureText("@photo_a_bordeaux");r.fillRect(0,150,i-(400+o.width),10),r.fillText("@photo_a_bordeaux",i-(350+o.width),190),r.fillRect(3796,150,300,10),r.font="180px sans-serif",pubTxt="",pubCoords=r.measureText(pubTxt),siteTxt="Participez sur bordeaux-photo.fr",shareTxt="Partage et commente !",siteCoords=r.measureText(siteTxt),shareCoords=r.measureText(shareTxt),r.rotate(-Math.PI/2),r.fillRect(-4096,150,300,10),r.fillText(pubTxt,-3696,200),r.fillRect(-3596+pubCoords.width,150,i-(100+pubCoords.width),10),r.rotate(Math.PI),r.fillRect(0,-3946,300,10),r.fillText(siteTxt,400,-3876),r.fillRect(500+siteCoords.width,-3946,i-(100+siteCoords.width),10),r.rotate(-Math.PI/2),r.fillRect(0,3946,300,10),r.fillText(shareTxt,400,3996),r.fillRect(500+shareCoords.width,3946,i-(100+shareCoords.width),10);var s=e.dataset.type.capitalize(),d=r.measureText(s);r.fillText(s,500,1e3),function(t,e,a){var r=new Image;r.addEventListener("load",(function(){e.drawImage(r,500+a.width+50,840,200,200)}),!1),r.src=t.dataset.typeicon}(e,r,d),r.fillText(e.dataset.dates,500,1250),r.fillText("Thème",500,2e3);var c=[e.dataset.theme],f=400,h=!1;for(r.textBaseline="top";!h;){r.font="".concat(f,"px sans-serif");for(var u=0;u<c.length;u++){if(w=r.measureText(c[u]).width,w+500>3596){wLetter=w/c[u].length,lMax=Math.floor(3096/wLetter);for(var m=lMax;" "!==c[u].charAt(m)&&m>0;)m--;if(0==m){f-=20;break}n=c.indexOf(c[u]),c=[].concat(t(c.slice(0,n)),[c[u].slice(0,m),c[u].slice(m+1)],t(c.slice(n+1))),console.log(c),console.log(c.length);break}console.log(u),r.fillText(c[u],500,2100+400*u),h=!0}}a.addEventListener("click",(function(){l(this,e.dataset.theme)})),a.addEventListener("contextmenu",(function(t){t.preventDefault(),l(this,e.dataset.theme)})),a.parentElement.addEventListener("mouseenter",(function(){this.classList.remove("downloaded")}))}))})();